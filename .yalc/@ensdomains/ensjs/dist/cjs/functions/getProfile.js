"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const address_encoder_1 = require("@ensdomains/address-encoder");
const ethers_1 = require("ethers");
const contentHash_1 = require("../utils/contentHash");
const hexEncodedName_1 = require("../utils/hexEncodedName");
const validation_1 = require("../utils/validation");
const makeMulticallData = async ({ _getAddr, _getContentHash, _getText, resolverMulticallWrapper, }, name, options) => {
    let calls = [];
    options.texts &&
        (calls = [
            ...calls,
            ...(await Promise.all(options.texts.map(async (x) => ({
                key: x,
                data: await _getText.raw(name, x),
                type: 'text',
            })))),
        ]);
    options.coinTypes &&
        (calls = [
            ...calls,
            ...(await Promise.all(options.coinTypes.map(async (x) => ({
                key: x,
                data: await _getAddr.raw(name, x, true),
                type: 'addr',
            })))),
        ]);
    if (typeof options.contentHash === 'boolean' && options.contentHash) {
        calls.push({
            key: 'contentHash',
            data: await _getContentHash.raw(name),
            type: 'contenthash',
        });
    }
    if (!calls.find((x) => x.key === '60')) {
        calls.push({
            key: '60',
            data: await _getAddr.raw(name, '60', true),
            type: 'addr',
        });
    }
    const prRawData = await resolverMulticallWrapper.raw(calls.map((x) => x.data));
    return { data: prRawData.data, calls };
};
const makeHashIndexes = (data, name) => [...data.matchAll(ethers_1.ethers.utils.namehash(name).substring(2))].map((x) => x.index / 2 - 1);
const getDataForName = async ({ contracts, _getAddr, _getContentHash, _getText, resolverMulticallWrapper, }, name, options) => {
    const universalResolver = await contracts?.getUniversalResolver();
    const { data, calls } = await makeMulticallData({ _getAddr, _getContentHash, _getText, resolverMulticallWrapper }, name, options);

    console.log('name: ', name)
    console.log('hexEncodeName: ', (0, hexEncodedName_1.hexEncodeName)(name))
    console.log('data: ', data)

    const customData = "0xac9650d80000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001d00000000000000000000000000000000000000000000000000000000000003a00000000000000000000000000000000000000000000000000000000000000460000000000000000000000000000000000000000000000000000000000000052000000000000000000000000000000000000000000000000000000000000005e000000000000000000000000000000000000000000000000000000000000006a0000000000000000000000000000000000000000000000000000000000000072000000000000000000000000000000000000000000000000000000000000007a0000000000000000000000000000000000000000000000000000000000000082000000000000000000000000000000000000000000000000000000000000008a0000000000000000000000000000000000000000000000000000000000000092000000000000000000000000000000000000000000000000000000000000009a00000000000000000000000000000000000000000000000000000000000000a200000000000000000000000000000000000000000000000000000000000000aa00000000000000000000000000000000000000000000000000000000000000b200000000000000000000000000000000000000000000000000000000000000ba00000000000000000000000000000000000000000000000000000000000000c200000000000000000000000000000000000000000000000000000000000000ca00000000000000000000000000000000000000000000000000000000000000d200000000000000000000000000000000000000000000000000000000000000da00000000000000000000000000000000000000000000000000000000000000e200000000000000000000000000000000000000000000000000000000000000ea00000000000000000000000000000000000000000000000000000000000000f200000000000000000000000000000000000000000000000000000000000000fa0000000000000000000000000000000000000000000000000000000000000102000000000000000000000000000000000000000000000000000000000000010a0000000000000000000000000000000000000000000000000000000000000112000000000000000000000000000000000000000000000000000000000000011a0000000000000000000000000000000000000000000000000000000000000122000000000000000000000000000000000000000000000000000000000000012a0000000000000000000000000000000000000000000000000000000000000008459d1d43cc3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee2290000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000b6465736372697074696f6e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008459d1d43cc3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee2290000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000375726c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008459d1d43cc3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee22900000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000007616e6f746865720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008459d1d43cc3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee22900000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000005656d61696c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee229000000000000000000000000000000000000000000000000000000000000003c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee2290000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee2290000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee2290000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee2290000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee2290000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee229000000000000000000000000000000000000000000000000000000000000002b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee229000000000000000000000000000000000000000000000000000000000000003d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee2290000000000000000000000000000000000000000000000000000000000000076000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee2290000000000000000000000000000000000000000000000000000000000000089000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee2290000000000000000000000000000000000000000000000000000000000000090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee2290000000000000000000000000000000000000000000000000000000000000091000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee2290000000000000000000000000000000000000000000000000000000000000094000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee22900000000000000000000000000000000000000000000000000000000000000c2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee22900000000000000000000000000000000000000000000000000000000000000c3000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee22900000000000000000000000000000000000000000000000000000000000001b2000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee22900000000000000000000000000000000000000000000000000000000000002ca000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee22900000000000000000000000000000000000000000000000000000000000002bc000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee229000000000000000000000000000000000000000000000000000000008000003d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee2290000000000000000000000000000000000000000000000000000000080000064000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee229000000000000000000000000000000000000000000000000000000008000a4b1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee2290000000000000000000000000000000000000000000000000000000080000038000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee229000000000000000000000000000000000000000000000000000000008000000a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee229000000000000000000000000000000000000000000000000000000008000a4ec000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044f1cb7e06c3c98353b9c754fcea89580bd76954ba22e42ab2cec13cb7b8b10db8447ee22900000000000000000000000000000000000000000000000000000000800000fa00000000000000000000000000000000000000000000000000000000"
    const customHexName = "0x076a6566666c61750365746800"

    let resolver;
    try {
        throw 'cjs'
        resolver = await universalResolver?.resolve((0, hexEncodedName_1.hexEncodeName)(name), data);
        // resolver = [
        //     "0x0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001d00000000000000000000000000000000000000000000000000000000000003a0000000000000000000000000000000000000000000000000000000000000042000000000000000000000000000000000000000000000000000000000000004a000000000000000000000000000000000000000000000000000000000000005000000000000000000000000000000000000000000000000000000000000000580000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000006800000000000000000000000000000000000000000000000000000000000000700000000000000000000000000000000000000000000000000000000000000076000000000000000000000000000000000000000000000000000000000000007e0000000000000000000000000000000000000000000000000000000000000086000000000000000000000000000000000000000000000000000000000000008c0000000000000000000000000000000000000000000000000000000000000094000000000000000000000000000000000000000000000000000000000000009a00000000000000000000000000000000000000000000000000000000000000a200000000000000000000000000000000000000000000000000000000000000a800000000000000000000000000000000000000000000000000000000000000b000000000000000000000000000000000000000000000000000000000000000b600000000000000000000000000000000000000000000000000000000000000be00000000000000000000000000000000000000000000000000000000000000c400000000000000000000000000000000000000000000000000000000000000cc00000000000000000000000000000000000000000000000000000000000000d200000000000000000000000000000000000000000000000000000000000000da00000000000000000000000000000000000000000000000000000000000000e200000000000000000000000000000000000000000000000000000000000000ea00000000000000000000000000000000000000000000000000000000000000f200000000000000000000000000000000000000000000000000000000000000fa0000000000000000000000000000000000000000000000000000000000000102000000000000000000000000000000000000000000000000000000000000010a000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000648656c6c6f32000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000b747769747465722e636f6d00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001266616b65656d61696c4066616b652e636f6d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000014866b3c4994e1416b7c738b9818b31dc246b95eee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001600149010587f8364b964fcaa70687216b53bd2cbd79800000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000014866b3c4994e1416b7c738b9818b31dc246b95eee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000140000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000014866b3c4994e1416b7c738b9818b31dc246b95eee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001442d63ae25990889e35f215bc95884039ba35411500000000000000000000000000000000000000000000000000000000000000000000000000000000000000600000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001442d63ae25990889e35f215bc95884039ba354115000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000014866b3c4994e1416b7c738b9818b31dc246b95eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000014866b3c4994e1416b7c738b9818b31dc246b95eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000014866b3c4994e1416b7c738b9818b31dc246b95eee000000000000000000000000000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000014866b3c4994e1416b7c738b9818b31dc246b95eee000000000000000000000000",
        //     "0x42D63ae25990889E35F215bC95884039Ba354115"
        // ]
        // console.log('resolver: ', resolver)
    }
    catch (e) {
        console.error('getDataforName error: ', e)
        return;
    }
    const [recordData] = await resolverMulticallWrapper.decode(resolver['0']);
    const matchAddress = recordData[calls.findIndex((x) => x.key === '60')];
    return {
        address: matchAddress && (await _getAddr.decode(matchAddress)),
        records: await formatRecords({ _getAddr, _getContentHash, _getText }, recordData, calls, options),
        resolverAddress: resolver['1'],
    };
};
const formatRecords = async ({ _getText, _getAddr, _getContentHash, }, data, calls, options) => {
    let returnedRecords = (await Promise.all(data.map(async (item, i) => {
        let decodedFromAbi;
        let itemRet = {
            key: calls[i].key,
            type: calls[i].type,
        };
        if (itemRet.type === 'addr' || itemRet.type === 'contenthash') {
            decodedFromAbi = ethers_1.ethers.utils.defaultAbiCoder.decode(['bytes'], item)[0];
            if (ethers_1.ethers.utils.hexStripZeros(decodedFromAbi) === '0x') {
                return;
            }
        }
        switch (calls[i].type) {
            case 'text':
                itemRet = {
                    ...itemRet,
                    value: await _getText.decode(item),
                };
                if (itemRet.value === '')
                    return;
                break;
            case 'addr':
                try {
                    const addr = await _getAddr.decode(item, '', calls[i].key);
                    if (addr) {
                        itemRet = {
                            ...itemRet,
                            ...addr,
                        };
                        break;
                    }
                    else {
                        return;
                    }
                }
                catch {
                    return;
                }
            case 'contenthash':
                try {
                    itemRet = {
                        ...itemRet,
                        value: await _getContentHash.decode(item),
                    };
                }
                catch {
                    return;
                }
        }
        return itemRet;
    })))
        .filter((x) => {
        return typeof x === 'object';
    })
        .filter((x) => x !== null);
    let returnedResponse = {};
    if (typeof options.contentHash === 'string' ||
        typeof options.contentHash === 'object') {
        if (typeof options.contentHash === 'string' &&
            ethers_1.ethers.utils.hexStripZeros(options.contentHash) === '0x') {
            returnedResponse.contentHash = null;
        }
        else if (ethers_1.ethers.utils.isBytesLike(options.contentHash.decoded) &&
            ethers_1.ethers.utils.hexStripZeros(options.contentHash.decoded) === '0x') {
            returnedResponse.contentHash = null;
        }
        else {
            returnedResponse.contentHash = options.contentHash;
        }
    }
    else if (options.contentHash) {
        const foundRecord = returnedRecords.find((item) => item.type === 'contenthash');
        returnedResponse.contentHash = foundRecord ? foundRecord.value : null;
    }
    if (options.texts) {
        returnedResponse.texts = returnedRecords.filter((x) => x.type === 'text');
    }
    if (options.coinTypes) {
        returnedResponse.coinTypes = returnedRecords.filter((x) => x.type === 'addr');
    }
    return returnedResponse;
};
const graphFetch = async ({ gqlInstance }, name, wantedRecords) => {
    const query = gqlInstance.gql `
    query getRecords($name: String!) {
      domains(where: { name: $name }) {
        isMigrated
        createdAt
        resolver {
          texts
          coinTypes
          contentHash
          addr {
            id
          }
        }
      }
    }
  `;
    const client = gqlInstance.client;
    const { domains } = await client.request(query, { name });
    if (!domains || domains.length === 0)
        return;
    const [{ resolver: resolverResponse, isMigrated, createdAt }] = domains;
    let returnedRecords = {};
    if (!wantedRecords)
        return { isMigrated, createdAt };
    Object.keys(wantedRecords).forEach((key) => {
        const data = wantedRecords[key];
        if (typeof data === 'boolean' && data) {
            if (key === 'contentHash') {
                returnedRecords[key] = (0, contentHash_1.decodeContenthash)(resolverResponse.contentHash);
            }
            else {
                returnedRecords[key] = resolverResponse[key];
            }
        }
    });
    return { ...returnedRecords, isMigrated, createdAt };
};
const getProfileFromName = async ({ contracts, gqlInstance, _getAddr, _getContentHash, _getText, resolverMulticallWrapper, }, name, options) => {
    const usingOptions = !options || options?.texts === true || options?.coinTypes === true
        ? options || { contentHash: true, texts: true, coinTypes: true }
        : undefined;
    const graphResult = await graphFetch({ gqlInstance }, name, usingOptions);
    if (!graphResult)
        return;
    const { isMigrated, createdAt, ...wantedRecords } = graphResult;
    const result = await getDataForName({
        contracts,
        _getAddr,
        _getContentHash,
        _getText,
        resolverMulticallWrapper,
    }, name, usingOptions ? wantedRecords : options);
    if (!result)
        return { isMigrated, createdAt, message: "Records fetch didn't complete" };
    return { ...result, isMigrated, createdAt, message: undefined };
};
const getProfileFromAddress = async ({ contracts, gqlInstance, getName, _getAddr, _getContentHash, _getText, resolverMulticallWrapper, }, address, options) => {
    let name;
    try {
        name = await getName(address);
    }
    catch (e) {
        return;
    }
    if (!name || !name.name || name.name === '')
        return;
    if (!name.match)
        return { ...name, isMigrated: null, createdAt: null };
    const result = await getProfileFromName({
        contracts,
        gqlInstance,
        _getAddr,
        _getContentHash,
        _getText,
        resolverMulticallWrapper,
    }, name.name, options);
    if (!result || result.message)
        return;
    delete result.address;
    return {
        ...result,
        ...name,
        message: undefined,
    };
};
async function default_1({ contracts, gqlInstance, getName, _getAddr, _getContentHash, _getText, resolverMulticallWrapper, }, nameOrAddress, options) {
    if (options && options.coinTypes && typeof options.coinTypes !== 'boolean') {
        options.coinTypes = options.coinTypes.map((coin) => {
            if (!isNaN(parseInt(coin))) {
                return coin;
            }
            else {
                return `${address_encoder_1.formatsByName[coin.toUpperCase()].coinType}`;
            }
        });
    }
    const inputType = (0, validation_1.parseInputType)(nameOrAddress);
    if (inputType.type === 'unknown' || inputType.info === 'unsupported') {
        throw new Error('Invalid input type');
    }
    if (inputType.type === 'address') {
        return getProfileFromAddress({
            contracts,
            gqlInstance,
            getName,
            _getAddr,
            _getContentHash,
            _getText,
            resolverMulticallWrapper,
        }, nameOrAddress, options);
    }
    return getProfileFromName({
        contracts,
        gqlInstance,
        _getAddr,
        _getContentHash,
        _getText,
        resolverMulticallWrapper,
    }, nameOrAddress, options);
}
exports.default = default_1;
